{"version":3,"file":"index.js","sources":["../src/events/window.event.ts","../src/constants/drafts/invoiceMainVariables.ts","../assets/drafts/invoice-main.html?raw","../src/utils/draft.ts","../src/events/printer.event.ts","../src/utils/system.ts","../src/events/user.event.ts","../src/index.ts"],"sourcesContent":["import { app, BrowserWindow, ipcMain } from 'electron';\r\n\r\nexport const initWindowEvent = (window: BrowserWindow) => {\r\n  ipcMain.handle('maximize', () => window.maximize());\r\n  ipcMain.handle('minimize', () => window.minimize());\r\n  ipcMain.handle('exit', () => app.exit());\r\n  ipcMain.handle('restart', () => (app.relaunch(), app.exit()));\r\n  \r\n  ipcMain.handle('zoom', (event, zoomDirection) => {\r\n    var currentZoom = window.webContents.getZoomFactor();\r\n    if (zoomDirection === \"in\") {\r\n        window.webContents.zoomFactor = currentZoom + 0.2;\r\n    }\r\n    if (zoomDirection === \"out\") {\r\n        window.webContents.zoomFactor = currentZoom - 0.2;\r\n    }\r\n  });\r\n\r\n  ipcMain.on('changeURL', (event, path) => {\r\n    window.loadURL(path);\r\n  });\r\n};","export enum InvoiceMainDraftVariables {\r\n    HEIGHT = \"{{height}}\",\r\n    PRINT = \"{{print}}\",\r\n}","export default \"<html\\r\\n  style=\\\"width: 72mm;height: {{height}}mm; overflow: hidden; overflow-y: scroll;\\\"\\r\\n  lang=\\\"tr\\\"\\r\\n>\\r\\n  <head>\\r\\n    <meta charset=\\\"UTF-8\\\" />\\r\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\r\\n    <style>\\r\\n      ::-webkit-scrollbar {\\r\\n        width: 0 !important;\\r\\n      }\\r\\n      * {\\r\\n        margin: 0 auto;\\r\\n        padding: 0;\\r\\n      }\\r\\n      .invoice {\\r\\n        display: block;\\r\\n        width: 64mm;\\r\\n        font-family: Tahoma, serif;\\r\\n        padding: 0 4mm;\\r\\n      }\\r\\n      .header {\\r\\n        padding-bottom: 2mm;\\r\\n      }\\r\\n      .body {\\r\\n        padding: 2mm 0;\\r\\n      }\\r\\n      .w-100 {\\r\\n        width: 100% !important;\\r\\n      }\\r\\n      .w-50 {\\r\\n        width: 50% !important;\\r\\n      }\\r\\n      .d-block {\\r\\n        display: block !important;\\r\\n      }\\r\\n      .mt-1 {\\r\\n        margin-top: 1mm;\\r\\n      }\\r\\n      .mt-2 {\\r\\n        margin-top: 2mm;\\r\\n      }\\r\\n      .mt-3 {\\r\\n        margin-top: 3mm;\\r\\n      }\\r\\n      .mt-4 {\\r\\n        margin-top: 4mm;\\r\\n      }\\r\\n      .mt-5 {\\r\\n        margin-top: 5mm;\\r\\n      }\\r\\n      .mb-1 {\\r\\n        margin-bottom: 1mm;\\r\\n      }\\r\\n      .mb-2 {\\r\\n        margin-bottom: 2mm;\\r\\n      }\\r\\n      .mb-3 {\\r\\n        margin-bottom: 3mm;\\r\\n      }\\r\\n      .mb-4 {\\r\\n        margin-bottom: 4mm;\\r\\n      }\\r\\n      .mb-5 {\\r\\n        margin-bottom: 5mm;\\r\\n      }\\r\\n      .ml-1 {\\r\\n        margin-left: 1mm;\\r\\n      }\\r\\n      .ml-2 {\\r\\n        margin-left: 2mm;\\r\\n      }\\r\\n      .ml-3 {\\r\\n        margin-left: 3mm;\\r\\n      }\\r\\n      .ml-4 {\\r\\n        margin-left: 4mm;\\r\\n      }\\r\\n      .ml-5 {\\r\\n        margin-left: 5mm;\\r\\n      }\\r\\n      .bold {\\r\\n        font-weight: 700 !important;\\r\\n      }\\r\\n      .font-size-xxxs {\\r\\n        font-size: 3mm !important;\\r\\n      }\\r\\n      .font-size-xxs {\\r\\n        font-size: 3.4mm !important;\\r\\n      }\\r\\n      .font-size-x {\\r\\n        font-size: 3.8mm !important;\\r\\n      }\\r\\n      .font-size-xs {\\r\\n        font-size: 4.2mm !important;\\r\\n      }\\r\\n      .font-size-xm {\\r\\n        font-size: 5mm !important;\\r\\n      }\\r\\n      .font-size-xxm {\\r\\n        font-size: 5.5mm !important;\\r\\n      }\\r\\n      .font-size-xl {\\r\\n        font-size: 7.5mm !important;\\r\\n      }\\r\\n      .text-center {\\r\\n        text-align: center !important;\\r\\n      }\\r\\n      .text-left {\\r\\n        text-align: left !important;\\r\\n      }\\r\\n      .text-right {\\r\\n        text-align: right !important;\\r\\n      }\\r\\n      .float-left {\\r\\n        float: left !important;\\r\\n      }\\r\\n      .float-right {\\r\\n        float: right !important;\\r\\n      }\\r\\n    </style>\\r\\n    <title>Print</title>\\r\\n  </head>\\r\\n  <body>\\r\\n    <div\\r\\n      id=\\\"print\\\"\\r\\n      style=\\\"width:72mm; height: {{height}}mm; background-color: #ffffff;\\\"\\r\\n    >\\r\\n      `; {{print}}\\r\\n    </div>\\r\\n  </body>\\r\\n</html>\\r\\n\"","import { InvoiceMainDraftVariables } from '@/constants/drafts/invoiceMainVariables';\r\nimport { readFileSync } from 'fs';\r\nimport invoiceHTML from '@assets/drafts/invoice-main.html?raw';\r\n\r\n//const invoiceHTML = readFileSync('@assets/drafts/invoice-main.html', 'utf8');\r\n\r\nconst getInvoiceMain = (height: number, print: string) => {\r\n  let html = invoiceHTML.replaceAll(InvoiceMainDraftVariables.HEIGHT, height.toString());\r\n  html = html.replaceAll(InvoiceMainDraftVariables.PRINT, print);\r\n  return html;\r\n};\r\n\r\nexport const DraftUtil = {\r\n  getInvoiceMain,\r\n};\r\n","import { BrowserWindow, ipcMain } from 'electron';\r\nimport ptp from 'pdf-to-printer';\r\nimport pdf from 'html-pdf';\r\nimport del from 'del';\r\nimport fs from 'fs';\r\nimport { DraftUtil } from '@/utils/draft';\r\n\r\nexport const initPrinterEvent = (window: BrowserWindow) => {\r\n  ipcMain.handle(\r\n    'getPrinters',\r\n    async (event) => { \r\n      const printers = await window.webContents.getPrintersAsync();\r\n      return printers;}\r\n  );\r\n\r\n  ipcMain.handle(\r\n    'getPrinterSettings',\r\n    async (event) => { \r\n      const printers = await window.webContents.getPrintersAsync();\r\n      return printers;}\r\n  );\r\n\r\n      ipcMain.handle(\r\n    'setPrinterSettings',\r\n    async (event) => {\r\n      return false;}\r\n  );\r\n\r\n  ipcMain.handle('print', (event, args) => {\r\n    const jsonArgs = JSON.parse(args);\r\n\r\n    let invoiceHeight = jsonArgs.settings.height;\r\n    invoiceHeight = invoiceHeight ? invoiceHeight * 7 : 80;\r\n\r\n    const pdfOptions: pdf.CreateOptions = {\r\n        //win32: ['-print-settings \"noscale\"'],\r\n        type: 'pdf',\r\n        height: `${invoiceHeight}mm`,\r\n        width: '72mm',\r\n        renderDelay: 0,\r\n    };\r\n\r\n    const printOptions: ptp.PrintOptions = {\r\n        printer: jsonArgs.settings.printer,\r\n        scale: 'noscale'\r\n        //win32: ['-print-settings \"noscale\"'],\r\n    }\r\n    \r\n    const invoiceHTML = DraftUtil.getInvoiceMain(invoiceHeight, jsonArgs.data.map((e: { value: string; }) => e.value).join(''))\r\n\r\n    let dir = `./invoices/${Math.random()}.pdf`;\r\n\r\n    pdf.create(invoiceHTML, pdfOptions).toFile(dir, function (err, res) {\r\n      if (err) return console.log(err);\r\n      ptp.print(dir, printOptions).then(async () => {\r\n        console.log(dir);\r\n        await fs.unlink(dir, () => {\r\n            del.deleteAsync(dir);\r\n        });\r\n        return true;\r\n      }).catch((ptpErr) => {\r\n        console.error(ptpErr);\r\n      });\r\n    });\r\n\r\n    return false;\r\n  });\r\n\r\n  ipcMain.handle(\r\n    'multiPrint',\r\n    async (event) => {\r\n      return false;}\r\n  );\r\n\r\n    ipcMain.handle(\r\n    'viewInvoice',\r\n    async (event) => {\r\n      return false;}\r\n  );\r\n};","import si from 'systeminformation';\r\nimport os from 'os';\r\nimport crypto from 'crypto';\r\n\r\nconst getDeviceIds = async () => {\r\n  const system = await si.system();\r\n  const bios = await si.bios();\r\n  const osInfo = await si.osInfo();\r\n  const uuid = (system?.uuid) || (bios?.serial) || '';\r\n  const hostname = os.hostname();\r\n\r\n  const osIdRaw = uuid || `${osInfo.platform}|${osInfo.distro}|${osInfo.release}|${hostname}`;\r\n  const biosIdRaw = bios?.serial || `${bios?.vendor || ''}|${bios?.version || ''}|${bios?.releaseDate || ''}`;\r\n\r\n  return {\r\n    osIdRaw,\r\n    biosIdRaw,\r\n    system,\r\n    bios,\r\n    osInfo\r\n  };\r\n}\r\n\r\nconst createDeviceHash = async () => {\r\n  const { osIdRaw, biosIdRaw } = await getDeviceIds();\r\n\r\n  const combined = `${osIdRaw}||${biosIdRaw}`;\r\n  const hash = crypto.createHash('sha256').update(combined).digest('hex');\r\n\r\n  return hash;\r\n}\r\n\r\n\r\nexport const SystemUtil = {\r\n    getDeviceIds,\r\n    createDeviceHash\r\n}","import { SystemUtil } from '@/utils/system';\r\nimport { app, BrowserWindow, ipcMain } from 'electron';\r\n\r\nexport const initUserEvent = (window: BrowserWindow) => {\r\n  ipcMain.handle('getToken', async () => {\r\n    const token = await SystemUtil.createDeviceHash();\r\n    return token;\r\n  });\r\n};","import config from 'config';\r\nimport { app, BrowserWindow } from 'electron';\r\n//import {checkForUpdates, downloadAsar} from \"./updater\";\r\nimport { initWindowEvent } from '@/events/window.event';\r\nimport { initPrinterEvent } from '@/events/printer.event';\r\nimport { initUserEvent } from './events/user.event';\r\n\r\nconst url = config.get('url') as string;\r\nconst runType = config.get('runType') as string;\r\nconst isDev = runType === 'dev' ? true : false;\r\n\r\napp.whenReady().then(() => {\r\n  const window = new BrowserWindow({\r\n    minWidth: 1200,\r\n    minHeight: 800,\r\n    autoHideMenuBar: true,\r\n    fullscreen: !isDev,\r\n    frame: false,\r\n    titleBarStyle: 'hidden',\r\n    resizable: false,\r\n    center: true,\r\n    webPreferences: {\r\n      nodeIntegration: true,\r\n      contextIsolation: false,\r\n      devTools: isDev,\r\n    },\r\n  });\r\n\r\n  window.loadURL(url);\r\n\r\n  if(isDev){\r\n      window.webContents.openDevTools();\r\n  }\r\n\r\n  initWindowEvent(window);\r\n  initPrinterEvent(window);\r\n  initUserEvent(window);\r\n\r\n  if (!app.isPackaged) return;\r\n\r\n  app.on('window-all-closed', () => {\r\n    if (process.platform !== 'darwin') app.quit();\r\n  });\r\n\r\n  /*ipcMain.on('check-for-updates', (event) =>\r\n    checkForUpdates().then((data) =>\r\n      data\r\n        ? downloadAsar().then((data) => event.reply('cfu-data', data))\r\n        : event.reply('cfu-data', data)\r\n    )\r\n  );*/\r\n});\r\n"],"names":["ipcMain","app","InvoiceMainDraftVariables","invoiceHTML","BrowserWindow"],"mappings":"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"}